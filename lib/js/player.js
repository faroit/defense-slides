!function(a,b,c,d){function e(b,c){this.element=a(b),this.options=a.extend({},g,c),this.options.mute||this.options.solo||(console.error("Cannot disable both solo and mute, reactivating solo"),this.options.solo=!0),this.options.onlyradiosolo&&(this.options.mute=!1,this.options.radiosolo=!0),this._defaults=g,this._name=f,this.playing=!1,this.currentTime=0,this.duration=1,this.firstWorkingTrack=1/0,this.repeat=this.options.repeat,this.lockSeekBar=!1,this.tracks=Array(),this.loadedAudio=0,this.init()}var f="multitrackAudioPlayer",g={mute:!0,solo:!0,globalsolo:!0,repeat:!1,radiosolo:!1,onlyradiosolo:!1,switchimage:!1};e.prototype.init=function(){var c=this;this.element.addClass("jquery-multitrack-player"),0===this.element.find(".main-control").length&&this.element.prepend('<div class="overlay"><span>Load</span><p id="overlaytext"></p></div><div class="main-control"><ul class="control"><li class="play button">Play</li><li class="stop button">Stop</li><li class="repeat button">Repeat</li><li class="seek"><span class="bar"></span></li><li class="time">0:00:00 / 0:00:00</li></ul></div>'),c.element.find(".seekable:not(.seekable-img-wrap > .seekable)").each(function(){c.originalImage=this.src,a(this).data("style")?(a(this).css("width","100%"),a(this).wrap('<div class="seekable-img-wrap" style="'+a(this).data("style")+' display: block;"></div>')):a(this).wrap('<div class="seekable-img-wrap"></div>'),a(this).after('<div class="seekable-area" style=" left: '+(a(this).data("seekMarginLeft")||0)+"%; right: "+(a(this).data("seekMarginRight")||0)+'%;"><div class="seekable-playhead"></div></div>')}),a(".seekable-img-wrap").on("dragstart",function(a){a.preventDefault()});var d=a('<ul class="tracks"></ul>');c.element.find("audio").each(function(b){a(this).prop("preload","none"),a(this).prop("controls",!1),c.tracks[b]={mute:!1,solo:!1,error:!1,ready:!1},a(this).find("source").andSelf().bind("error",function(){a(this).closest("audio")[0].networkState==HTMLMediaElement.NETWORK_NO_SOURCE&&(c.tracks[b].error=!0,c.unbindEvents(),c.apply())}),d.append('<li class="track" style="'+a(this).attr("style")+'">'+a(this).attr("title")+'<ul class="control">'+(c.options.mute?'<li class="mute button" title="Mute">Mute</li>':"")+(c.options.solo?c.options.radiosolo?'<li class="solo radio button" title="Solo">Solo</li>':'<li class="solo button" title="Solo">Solo</li>':"")+"</ul></li>"),a(this).hide()}),this.options.mute||(this.tracks[0].solo=!0),c.element.append(d),a(this.players()[0]).bind("timeupdate",function(){c.currentTime=this.currentTime/this.duration*100,c.lockSeekBar||(c.element.find(".seek .bar").css("width",this.currentTime/this.duration*100+"%"),c.element.find(".seekable-area .seekable-playhead").css("width",this.currentTime/this.duration*100+"%")),c.element.find(".time").html(c.format_currentTime(this.currentTime)+" / "+c.format_currentTime(this.duration))}),a(this.players()[0]).bind("ended",function(){a(this.element).trigger("ended",this),c.playing=c.repeat,c.apply()}),this.element.one("click",".overlay span",a.proxy(this.load,this)),this.element.one("loaded",a.proxy(this.loaded,this)),this.element.one("errored",a.proxy(this.errored,this));var e=b.navigator.userAgent;(e.match(/iPad/i)||e.match(/iPhone/i))&&(this.errored(),this.element.find("#overlaytext").text("iOS is currently not supported.")),this.apply()},e.prototype.destroy=function(){this.element.find(".main-control").remove(),this.element.find(".tracks").remove(),this.element.removeData()},e.prototype.load=function(){var b=this;this.element.find(".overlay span").addClass("fa-spin"),this.element.find(".overlay").addClass("loading"),this.element.find("audio").each(function(c){a(this).bind("canplaythrough",function(){b.firstWorkingTrack=Math.min(b.firstWorkingTrack,c),b.tracks[c].ready=!0,b.duration=this.duration,b.apply()}),a(this).prop("preload","auto"),a(this).load()}),this.apply()},e.prototype.loaded=function(){this.element.find(".overlay").removeClass("loading"),this.element.find(".overlay").addClass("disabled"),this.element.find(".overlay").remove(),this.bindEvents(),this.apply()},e.prototype.errored=function(){this.element.find(".play").addClass("disabled"),this.element.addClass("error"),this.element.find(".overlay span").removeClass("fa-spin"),this.unbindEvents(),this.apply()},e.prototype.unbindEvents=function(){this.element.off("click",".overlay span"),this.element.off("loaded"),this.element.off("click",".play"),this.element.off("click",".stop"),this.element.off("click",".repeat"),this.element.off("mousedown",".seek"),this.element.off("mouseup",".seek"),this.element.on("mousedown",".seekable-area"),this.element.on("mouseup",".seekable-area"),this.element.off("click",".mute"),this.element.off("click",".solo")},e.prototype.bindEvents=function(){this.element.on("click",".play",a.proxy(this.event_play,this)),this.element.on("click",".stop",a.proxy(this.event_stop,this)),this.element.on("click",".repeat",a.proxy(this.event_repeat,this)),this.element.on("mousedown",".seek",a.proxy(this.event_seekDown,this)),this.element.on("mouseup",".seek",a.proxy(this.event_seekUp,this)),this.element.on("mousedown",".seekable-area",a.proxy(this.event_seekDown,this)),this.element.on("mouseup",".seekable-area",a.proxy(this.event_seekUp,this)),this.element.on("click",".mute",a.proxy(this.event_mute,this)),this.element.on("click",".solo",a.proxy(this.event_solo,this))},e.prototype.event_play=function(b){this.playing=!this.playing,this.apply(),a(this.element).trigger("play",this),b.stopPropagation()},e.prototype.event_stop=function(b){this.playing=!1,this.currentTime=0,this.seek(),this.apply(),a(this.element).trigger("stop",this),b.stopPropagation()},e.prototype.event_repeat=function(b){this.repeat=!this.repeat,this.apply(),a(this.element).trigger("repeat",this),b.stopPropagation()},e.prototype.event_seekDown=function(a){this.lockSeekBar=!0,a.stopPropagation()},e.prototype.event_seekUp=function(b){var c="."+b.currentTarget.className,d=a(b.target).closest(c),e=("."+d.context.className,b.pageX-d.offset().left-2);e=e/d.width()*100,this.currentTime=e,this.seek(),this.lockSeekBar=!1,b.stopPropagation()},e.prototype.event_solo=function(b){var c=this._index_from_target(b.target),d=this,e=this.tracks[c].solo;if((b.shiftKey||this.options.radiosolo)&&a.each(this.tracks,function(a,b){d.tracks[a].solo=!1}),this.tracks[c].solo=!e,this.options.switchimage){var f,g=0;a.each(this.tracks,function(a,b){d.tracks[a].solo===!0&&(g++,f=d.players()[a].dataset.img)}),1!==g&&(f=d.originalImage),this.element.find(".seekable").attr("src",f)}this.apply(),a(this.element).trigger("solo",this),b.stopPropagation()},e.prototype.event_mute=function(b){var c=this._index_from_target(b.target);this.tracks[c].mute=!this.tracks[c].mute,this.apply(),a(this.element).trigger("mute",this),b.stopPropagation()},e.prototype.seek=function(){var b=this;this.players().each(function(){this.pause(),this.currentTime=b.currentTime/100*this.duration,b.playing&&this.play()}),a(this.element).trigger("seek",this)},e.prototype.apply=function(){var b=this,c=!1;a.each(this.tracks,function(a,d){c=c||b.tracks[a].solo});var d=!0;a.each(this.tracks,function(a,c){d=d&&b.tracks[a].ready}),d&&(this.playing?(this.players().each(function(){this.play()}),this.element.find(".play").addClass("checked")):(this.players().each(function(){this.pause()}),this.element.find(".play").removeClass("checked"))),this.repeat?this.element.find(".repeat").addClass("checked"):this.element.find(".repeat").removeClass("checked"),d&&(this.element.find(".play").removeClass("disabled"),this.element.addClass("ready"),this.element.trigger("loaded"));var e=!1;a.each(this.tracks,function(a,c){e=e||b.tracks[a].error}),e&&(this.element.trigger("errored"),this.element.find("#overlaytext").text()||this.element.find("#overlaytext").text("One or more audio files failed to load.")),a.each(this.tracks,function(a,d){var e=b.element.find(".tracks li.track:nth-child("+(a+1)+")");b.players()[a].volume=1,b.tracks[a].error&&(e.addClass("error"),e.find(".control li").addClass("disabled")),b.tracks[a].mute?e.find(".mute").addClass("checked"):e.find(".mute").removeClass("checked"),b.tracks[a].solo?e.find(".solo").addClass("checked"):e.find(".solo").removeClass("checked"),b.tracks[a].mute?b.players()[a].volume=0:b.players()[a].volume=1,c&&(b.tracks[a].solo&&!b.tracks[a].mute?b.players()[a].volume=1:b.players()[a].volume=0)}),a(this.element).trigger("apply",this),this.playing&&this.options.globalsolo&&this.other_instances().each(function(){a(this).data("plugin_"+f).pause()}),this.deselect()},e.prototype.pause=function(b){this.playing=!1,this.apply(),a(this.element).trigger("play",this)},e.prototype.players=function(a){return this.element.find("audio")},e.prototype.deselect=function(a){var d="getSelection"in b?b.getSelection():"selection"in c?c.selection:null;"removeAllRanges"in d?d.removeAllRanges():"empty"in d&&d.empty()},e.prototype._index_from_target=function(b){return a(b).closest(".track").prevAll().length},e.prototype.other_instances=function(){return a(".jquery-multitrack-player").not(this.element)},e.prototype.format_currentTime=function(a){var b=Math.floor(a),c=Math.floor(b/3600);b-=3600*c;var d=Math.floor(b/60);return b-=60*d,c+":"+(10>d?"0"+d:d)+":"+(10>b?"0"+b:b)},a.fn[f]=function(b){return this.each(function(){a(this).data("plugin_"+f)||a(this).data("plugin_"+f,new e(this,b))})}}(jQuery,window,document);
